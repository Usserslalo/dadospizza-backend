generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model addon_prices {
  id       BigInt  @id @default(autoincrement())
  id_addon BigInt
  id_size  BigInt
  price    Decimal @db.Decimal(10, 2)
  addons   addons  @relation(fields: [id_addon], references: [id], onDelete: Cascade, map: "addon_prices_ibfk_1")
  sizes    sizes   @relation(fields: [id_size], references: [id], onDelete: Cascade, map: "addon_prices_ibfk_2")

  @@unique([id_addon, id_size], map: "id_addon")
  @@index([id_size], map: "id_size")
}

model addons {
  id                BigInt              @id @default(autoincrement())
  name              String              @unique(map: "name") @db.VarChar(100)
  created_at        DateTime            @db.Timestamp(0)
  updated_at        DateTime            @db.Timestamp(0)
  addon_prices      addon_prices[]
  order_item_addons order_item_addons[]
}

model address {
  id           BigInt   @id @default(autoincrement())
  id_user      BigInt
  address      String   @db.VarChar(255)
  neighborhood String   @db.VarChar(180)
  alias        String?  @db.VarChar(100)
  lat          Float
  lng          Float
  created_at   DateTime @db.Timestamp(0)
  updated_at   DateTime @db.Timestamp(0)
  users        users    @relation(fields: [id_user], references: [id], onDelete: Cascade, map: "address_ibfk_1")
  orders       orders[]

  @@index([id_user], map: "id_user")
}

model branches {
  id         BigInt   @id @default(autoincrement())
  name       String   @db.VarChar(100)
  address    String   @db.Text
  lat        Float?
  lng        Float?
  phone      String?  @db.VarChar(20)
  created_at DateTime @db.Timestamp(0)
  updated_at DateTime @db.Timestamp(0)
  orders     orders[]
  users      users[]
}

model categories {
  id              BigInt            @id @default(autoincrement())
  name            String            @unique(map: "name") @db.VarChar(180)
  description     String?           @db.Text
  created_at      DateTime          @db.Timestamp(0)
  updated_at      DateTime          @db.Timestamp(0)
  category_prices category_prices[]
  products        products[]
}

model category_prices {
  id          BigInt     @id @default(autoincrement())
  id_category BigInt
  id_size     BigInt
  price       Decimal    @db.Decimal(10, 2)
  categories  categories @relation(fields: [id_category], references: [id], onDelete: Cascade, map: "category_prices_ibfk_1")
  sizes       sizes      @relation(fields: [id_size], references: [id], onDelete: Cascade, map: "category_prices_ibfk_2")

  @@unique([id_category, id_size], map: "id_category")
  @@index([id_size], map: "id_size")
}

model order_has_products {
  id                BigInt              @id @default(autoincrement())
  id_order          BigInt
  id_product        BigInt
  id_size           BigInt?
  quantity          Int
  price_per_unit    Decimal             @db.Decimal(10, 2)
  created_at        DateTime            @db.Timestamp(0)
  updated_at        DateTime            @db.Timestamp(0)
  orders            orders              @relation(fields: [id_order], references: [id], onDelete: Cascade, map: "order_has_products_ibfk_1")
  products          products            @relation(fields: [id_product], references: [id], onDelete: Cascade, map: "order_has_products_ibfk_2")
  sizes             sizes?              @relation(fields: [id_size], references: [id], onDelete: Cascade, map: "order_has_products_ibfk_3")
  order_item_addons order_item_addons[]

  @@index([id_order], map: "id_order")
  @@index([id_product], map: "id_product")
  @@index([id_size], map: "id_size")
}

model order_item_addons {
  id                   BigInt             @id @default(autoincrement())
  id_order_has_product BigInt
  id_addon             BigInt
  price_at_purchase    Decimal            @db.Decimal(10, 2)
  order_has_products   order_has_products @relation(fields: [id_order_has_product], references: [id], onDelete: Cascade, map: "order_item_addons_ibfk_1")
  addons               addons             @relation(fields: [id_addon], references: [id], onDelete: Cascade, map: "order_item_addons_ibfk_2")

  @@index([id_addon], map: "id_addon")
  @@index([id_order_has_product], map: "id_order_has_product")
}

model orders {
  id                              BigInt               @id @default(autoincrement())
  id_client                       BigInt
  id_delivery                     BigInt?
  id_address                      BigInt
  id_branch                       BigInt
  status                          orders_status
  payment_method                  String               @default("Efectivo") @db.VarChar(50)
  subtotal                        Decimal              @default(0.00) @db.Decimal(10, 2)
  delivery_fee                    Decimal              @default(0.00) @db.Decimal(10, 2)
  total                           Decimal              @default(0.00) @db.Decimal(10, 2)
  created_at                      DateTime             @db.Timestamp(0)
  updated_at                      DateTime             @db.Timestamp(0)
  order_has_products              order_has_products[]
  users_orders_id_clientTousers   users                @relation("orders_id_clientTousers", fields: [id_client], references: [id], onDelete: Cascade, map: "orders_ibfk_1")
  users_orders_id_deliveryTousers users?               @relation("orders_id_deliveryTousers", fields: [id_delivery], references: [id], onDelete: Cascade, map: "orders_ibfk_2")
  address                         address              @relation(fields: [id_address], references: [id], onDelete: Cascade, map: "orders_ibfk_3")
  branches                        branches             @relation(fields: [id_branch], references: [id], onDelete: Cascade, map: "orders_ibfk_4")

  @@index([id_address], map: "id_address")
  @@index([id_branch], map: "id_branch")
  @@index([id_client], map: "id_client")
  @@index([id_delivery], map: "id_delivery")
}

model product_images {
  id         BigInt   @id @default(autoincrement())
  id_product BigInt
  image_url  String   @db.VarChar(255)
  products   products @relation(fields: [id_product], references: [id], onDelete: Cascade, map: "product_images_ibfk_1")

  @@index([id_product], map: "id_product")
}

model products {
  id                 BigInt               @id @default(autoincrement())
  name               String               @unique(map: "name") @db.VarChar(180)
  description        String               @db.Text
  price              Decimal?             @db.Decimal(10, 2)
  id_category        BigInt
  is_available       Boolean?             @default(true)
  created_at         DateTime             @db.Timestamp(0)
  updated_at         DateTime             @db.Timestamp(0)
  order_has_products order_has_products[]
  product_images     product_images[]
  categories         categories           @relation(fields: [id_category], references: [id], onDelete: Cascade, map: "products_ibfk_1")

  @@index([id_category], map: "id_category")
}

model roles {
  id             BigInt           @id @default(autoincrement())
  name           String           @unique(map: "name") @db.VarChar(90)
  image          String?          @db.VarChar(255)
  route          String           @db.VarChar(180)
  created_at     DateTime         @db.Timestamp(0)
  updated_at     DateTime         @db.Timestamp(0)
  user_has_roles user_has_roles[]
}

model sizes {
  id                 BigInt               @id @default(autoincrement())
  name               String               @unique(map: "name") @db.VarChar(100)
  created_at         DateTime             @db.Timestamp(0)
  updated_at         DateTime             @db.Timestamp(0)
  addon_prices       addon_prices[]
  category_prices    category_prices[]
  order_has_products order_has_products[]
}

model user_has_roles {
  id_user    BigInt
  id_rol     BigInt
  created_at DateTime @db.Timestamp(0)
  updated_at DateTime @db.Timestamp(0)
  users      users    @relation(fields: [id_user], references: [id], onDelete: Cascade, map: "user_has_roles_ibfk_1")
  roles      roles    @relation(fields: [id_rol], references: [id], onDelete: Cascade, map: "user_has_roles_ibfk_2")

  @@id([id_user, id_rol])
  @@index([id_rol], map: "id_rol")
}

model users {
  id                               BigInt           @id @default(autoincrement())
  email                            String           @unique(map: "email") @db.VarChar(180)
  name                             String           @db.VarChar(90)
  lastname                         String           @db.VarChar(90)
  notification_token               String?          @db.VarChar(255)
  phone                            String           @unique(map: "phone") @db.VarChar(90)
  image                            String?          @db.VarChar(255)
  password                         String           @db.VarChar(255)
  id_branch                        BigInt?
  created_at                       DateTime         @db.Timestamp(0)
  updated_at                       DateTime         @db.Timestamp(0)
  address                          address[]
  orders_orders_id_clientTousers   orders[]         @relation("orders_id_clientTousers")
  orders_orders_id_deliveryTousers orders[]         @relation("orders_id_deliveryTousers")
  user_has_roles                   user_has_roles[]
  branches                         branches?        @relation(fields: [id_branch], references: [id], onDelete: SetNull, onUpdate: Cascade)
}

enum orders_status {
  PAGADO
  EN_PREPARACION @map("EN PREPARACION")
  DESPACHADO
  EN_CAMINO      @map("EN CAMINO")
  ENTREGADO
  CANCELADO
}
